<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>组件注册 | Weblog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/weblog/icon.png">
    <meta name="description" content="王贺楠的个人博客">
    
    <link rel="preload" href="/weblog/assets/css/0.styles.570b819f.css" as="style"><link rel="preload" href="/weblog/assets/js/app.eefccb8e.js" as="script"><link rel="preload" href="/weblog/assets/js/2.dbfb7c6a.js" as="script"><link rel="preload" href="/weblog/assets/js/51.8586e26f.js" as="script"><link rel="prefetch" href="/weblog/assets/js/10.f8c2c72b.js"><link rel="prefetch" href="/weblog/assets/js/11.d4e327d9.js"><link rel="prefetch" href="/weblog/assets/js/12.ee2dc6a7.js"><link rel="prefetch" href="/weblog/assets/js/13.a3a3b499.js"><link rel="prefetch" href="/weblog/assets/js/14.ead09c7e.js"><link rel="prefetch" href="/weblog/assets/js/15.f5c6f95a.js"><link rel="prefetch" href="/weblog/assets/js/16.04afe6fc.js"><link rel="prefetch" href="/weblog/assets/js/17.382c7d13.js"><link rel="prefetch" href="/weblog/assets/js/18.52eea6bd.js"><link rel="prefetch" href="/weblog/assets/js/19.30e45ce3.js"><link rel="prefetch" href="/weblog/assets/js/20.b8483ab0.js"><link rel="prefetch" href="/weblog/assets/js/21.3c184d9a.js"><link rel="prefetch" href="/weblog/assets/js/22.8af109a2.js"><link rel="prefetch" href="/weblog/assets/js/23.ed5c0b8a.js"><link rel="prefetch" href="/weblog/assets/js/24.14ea4201.js"><link rel="prefetch" href="/weblog/assets/js/25.1f3ae49b.js"><link rel="prefetch" href="/weblog/assets/js/26.674fa537.js"><link rel="prefetch" href="/weblog/assets/js/27.7708290f.js"><link rel="prefetch" href="/weblog/assets/js/28.253b6864.js"><link rel="prefetch" href="/weblog/assets/js/29.cf658570.js"><link rel="prefetch" href="/weblog/assets/js/3.f10b48a9.js"><link rel="prefetch" href="/weblog/assets/js/30.ecea30b5.js"><link rel="prefetch" href="/weblog/assets/js/31.353916dc.js"><link rel="prefetch" href="/weblog/assets/js/32.70c471b8.js"><link rel="prefetch" href="/weblog/assets/js/33.2046d5ff.js"><link rel="prefetch" href="/weblog/assets/js/34.d65fe706.js"><link rel="prefetch" href="/weblog/assets/js/35.1e4bba7e.js"><link rel="prefetch" href="/weblog/assets/js/36.c76be612.js"><link rel="prefetch" href="/weblog/assets/js/37.580f62e9.js"><link rel="prefetch" href="/weblog/assets/js/38.f7726144.js"><link rel="prefetch" href="/weblog/assets/js/39.1e2c12f4.js"><link rel="prefetch" href="/weblog/assets/js/4.89565c71.js"><link rel="prefetch" href="/weblog/assets/js/40.e1b6b8fe.js"><link rel="prefetch" href="/weblog/assets/js/41.e6433e8e.js"><link rel="prefetch" href="/weblog/assets/js/42.fb769ab0.js"><link rel="prefetch" href="/weblog/assets/js/43.b382479b.js"><link rel="prefetch" href="/weblog/assets/js/44.47622ca8.js"><link rel="prefetch" href="/weblog/assets/js/45.1387ff67.js"><link rel="prefetch" href="/weblog/assets/js/46.ea8e0fcf.js"><link rel="prefetch" href="/weblog/assets/js/47.6a9a93a1.js"><link rel="prefetch" href="/weblog/assets/js/48.76977a18.js"><link rel="prefetch" href="/weblog/assets/js/49.a157cbcb.js"><link rel="prefetch" href="/weblog/assets/js/5.7eff868e.js"><link rel="prefetch" href="/weblog/assets/js/50.9f0506b1.js"><link rel="prefetch" href="/weblog/assets/js/52.e307a1be.js"><link rel="prefetch" href="/weblog/assets/js/53.c582cf3c.js"><link rel="prefetch" href="/weblog/assets/js/54.03ed5fe7.js"><link rel="prefetch" href="/weblog/assets/js/55.23116427.js"><link rel="prefetch" href="/weblog/assets/js/56.4af49a61.js"><link rel="prefetch" href="/weblog/assets/js/57.6b889e18.js"><link rel="prefetch" href="/weblog/assets/js/58.f1f0a4ad.js"><link rel="prefetch" href="/weblog/assets/js/59.411b8fe9.js"><link rel="prefetch" href="/weblog/assets/js/6.372c6965.js"><link rel="prefetch" href="/weblog/assets/js/60.2759755d.js"><link rel="prefetch" href="/weblog/assets/js/61.1df9a14d.js"><link rel="prefetch" href="/weblog/assets/js/62.b7f33a0e.js"><link rel="prefetch" href="/weblog/assets/js/63.974dabb9.js"><link rel="prefetch" href="/weblog/assets/js/64.cca16d57.js"><link rel="prefetch" href="/weblog/assets/js/65.586e0e7f.js"><link rel="prefetch" href="/weblog/assets/js/66.48daa51a.js"><link rel="prefetch" href="/weblog/assets/js/67.57ad892a.js"><link rel="prefetch" href="/weblog/assets/js/68.ce0612cf.js"><link rel="prefetch" href="/weblog/assets/js/69.c1abdf8f.js"><link rel="prefetch" href="/weblog/assets/js/7.3ac9f8c9.js"><link rel="prefetch" href="/weblog/assets/js/70.5c27c9e0.js"><link rel="prefetch" href="/weblog/assets/js/71.22eef0c4.js"><link rel="prefetch" href="/weblog/assets/js/72.dc8d97ea.js"><link rel="prefetch" href="/weblog/assets/js/73.788e2dd1.js"><link rel="prefetch" href="/weblog/assets/js/74.d751f795.js"><link rel="prefetch" href="/weblog/assets/js/75.7918ac7c.js"><link rel="prefetch" href="/weblog/assets/js/76.107c27f5.js"><link rel="prefetch" href="/weblog/assets/js/77.c912c850.js"><link rel="prefetch" href="/weblog/assets/js/78.e23be5ae.js"><link rel="prefetch" href="/weblog/assets/js/79.cbeaa75a.js"><link rel="prefetch" href="/weblog/assets/js/8.775ec4e4.js"><link rel="prefetch" href="/weblog/assets/js/80.8c1da72a.js"><link rel="prefetch" href="/weblog/assets/js/81.e042d0c1.js"><link rel="prefetch" href="/weblog/assets/js/82.13420b1a.js"><link rel="prefetch" href="/weblog/assets/js/83.da010ed3.js"><link rel="prefetch" href="/weblog/assets/js/84.421e9b99.js"><link rel="prefetch" href="/weblog/assets/js/85.32c7e90a.js"><link rel="prefetch" href="/weblog/assets/js/9.0fb2fb12.js">
    <link rel="stylesheet" href="/weblog/assets/css/0.styles.570b819f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weblog/" class="home-link router-link-active"><!----> <span class="site-name">Weblog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试" class="mobile-dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/weblog/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><a href="/weblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/weblog/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/weblog/vue/design/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/weblog/typescript/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><a href="/weblog/git/" class="nav-link">
  Git基本使用
</a></div> <a href="https://github.com/wanghenan12138" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试" class="mobile-dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/weblog/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/weblog/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/weblog/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/weblog/internet/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><a href="/weblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/weblog/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/weblog/vue/design/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/weblog/typescript/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><a href="/weblog/git/" class="nav-link">
  Git基本使用
</a></div> <a href="https://github.com/wanghenan12138" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>源码目录设计和架构设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/design/" class="sidebar-link">设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Rollup构建版本</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/rollup/" class="sidebar-link">Rollup基础知识</a></li><li><a href="/weblog/vue/rollup/vue.html" class="sidebar-link">Vue中的Rollup构建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>从入口到构造函数整体流程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/entry/" class="sidebar-link">整体流程</a></li><li><a href="/weblog/vue/entry/global.html" class="sidebar-link">initGlobalAPI流程</a></li><li><a href="/weblog/vue/entry/init.html" class="sidebar-link">initMixin流程</a></li><li><a href="/weblog/vue/entry/state.html" class="sidebar-link">stateMixin流程</a></li><li><a href="/weblog/vue/entry/events.html" class="sidebar-link">eventsMixin流程</a></li><li><a href="/weblog/vue/entry/lifecycle.html" class="sidebar-link">lifecycleMixin流程</a></li><li><a href="/weblog/vue/entry/render.html" class="sidebar-link">renderMixin流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>响应式原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/reactive/" class="sidebar-link">介绍</a></li><li><a href="/weblog/vue/reactive/prepare.html" class="sidebar-link">前置核心概念</a></li><li><a href="/weblog/vue/reactive/props.html" class="sidebar-link">props处理</a></li><li><a href="/weblog/vue/reactive/methods.html" class="sidebar-link">methods处理</a></li><li><a href="/weblog/vue/reactive/data.html" class="sidebar-link">data处理</a></li><li><a href="/weblog/vue/reactive/computed.html" class="sidebar-link">computed处理</a></li><li><a href="/weblog/vue/reactive/watch.html" class="sidebar-link">watch处理</a></li><li><a href="/weblog/vue/reactive/reactive.html" class="sidebar-link">深入响应式原理</a></li><li><a href="/weblog/vue/reactive/dep.html" class="sidebar-link">依赖收集</a></li><li><a href="/weblog/vue/reactive/notify.html" class="sidebar-link">派发更新</a></li><li><a href="/weblog/vue/reactive/nexttick.html" class="sidebar-link">nextTick实现原理</a></li><li><a href="/weblog/vue/reactive/problem.html" class="sidebar-link">变化侦测注意事项</a></li><li><a href="/weblog/vue/reactive/api.html" class="sidebar-link">变化侦测API实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>虚拟DOM和VNode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/dom/" class="sidebar-link">虚拟DOM</a></li><li><a href="/weblog/vue/dom/vnode.html" class="sidebar-link">VNode介绍</a></li><li><a href="/weblog/vue/dom/diff.html" class="sidebar-link">Diff算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>组件化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/component/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/weblog/vue/component/mount.html" class="sidebar-link">$mount方法</a></li><li><a href="/weblog/vue/component/render.html" class="sidebar-link">render和renderProxy</a></li><li><a href="/weblog/vue/component/createElement.html" class="sidebar-link">createElement</a></li><li><a href="/weblog/vue/component/createComponent.html" class="sidebar-link">createComponent</a></li><li><a href="/weblog/vue/component/merge.html" class="sidebar-link">合并策略</a></li><li><a href="/weblog/vue/component/patch.html" class="sidebar-link">update和patch</a></li><li><a href="/weblog/vue/component/lifecycle.html" class="sidebar-link">组件生命周期</a></li><li><a href="/weblog/vue/component/register.html" aria-current="page" class="active sidebar-link">组件注册</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编译原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/compile/" class="sidebar-link">介绍</a></li><li><a href="/weblog/vue/compile/compileToFunctions.html" class="sidebar-link">compileToFunctions</a></li><li><a href="/weblog/vue/compile/parse.html" class="sidebar-link">parse模板解析</a></li><li><a href="/weblog/vue/compile/optimize.html" class="sidebar-link">optimize优化</a></li><li><a href="/weblog/vue/compile/codegen.html" class="sidebar-link">codegen代码生成</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weblog/vue/expand/" class="sidebar-link">扩展</a></li><li><a href="/weblog/vue/expand/directive.html" class="sidebar-link">directive指令</a></li><li><a href="/weblog/vue/expand/filter.html" class="sidebar-link">filter过滤器</a></li><li><a href="/weblog/vue/expand/event.html" class="sidebar-link">event事件处理</a></li><li><a href="/weblog/vue/expand/vmodel.html" class="sidebar-link">v-model</a></li><li><a href="/weblog/vue/expand/slot.html" class="sidebar-link">插槽</a></li><li><a href="/weblog/vue/expand/keep-alive.html" class="sidebar-link">Keep-Alive</a></li><li><a href="/weblog/vue/expand/transition.html" class="sidebar-link">Transition</a></li><li><a href="/weblog/vue/expand/transition-group.html" class="sidebar-link">Transition-Group</a></li><li><a href="/weblog/vue/expand/plugin.html" class="sidebar-link">Vue.use插件机制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="组件注册"><a href="#组件注册" class="header-anchor">#</a> 组件注册</h1> <p>在开发<code>Vue</code>应用的时候，我们通常有两种注册组件的方式：全局注册和局部注册。这两种注册组件的方式结果是不同的，全局注册的组件可以在整个应用中直接使用，局部注册的组件只能在当前组件中使用。在这一章节，我们来分析一下在<code>Vue</code>中，是如何局部注册和全局注册组件的。</p> <p>注意：<code>Vue</code>中有一些组件不需要进行注册就可以直接使用，这些组件就是内置组件：<code>keep-alive</code>, <code>transition</code>、<code>transition-group</code>以及<code>component</code>。对于这些内置组件，我们在这个章节并不会去介绍，而是在后面的章节中单独划分一个章节去分析。</p> <p>对于需要全局注册的组件而言，我们使用<code>Vue.component</code>方法来注册我们的组件，这个方法其实是在<code>src/core/global-api/assets.js</code>文件中的<code>initAssetRegisters</code>被定义的，其代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ASSET_TYPES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'component'</span><span class="token punctuation">,</span> <span class="token string">'directive'</span><span class="token punctuation">,</span><span class="token string">'filter'</span><span class="token punctuation">]</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initAssetRegisters</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
      <span class="token parameter">id<span class="token operator">:</span> string<span class="token punctuation">,</span>
      definition<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">/* istanbul ignore if */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">validateComponentName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id
          definition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
        <span class="token keyword">return</span> definition
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码分析：当我们正确给<code>Vue.component</code>传递参数的时候，它会走<code>else</code>分支逻辑，在<code>else</code>分支逻辑中，对于组件而言它首先使用<code>validateComponentName</code>来校验组件名是否合法，其代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateComponentName</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^[a-zA-Z][\\-\\.0-9_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>unicodeRegExp<span class="token punctuation">.</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]*$</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Invalid component name: &quot;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&quot;. Component names '</span> <span class="token operator">+</span>
      <span class="token string">'should conform to valid custom element name in html5 specification.'</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> config<span class="token punctuation">.</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Do not use built-in or reserved HTML elements as component '</span> <span class="token operator">+</span>
      <span class="token string">'id: '</span> <span class="token operator">+</span> name
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于组件名而言，一方面它需要合法，另外一方面不能是内置或保留<code>html</code>标签。在校验通过后，它调用<code>this.options._base.extend</code>方法，实际上相当于调用<code>Vue.extend</code>方法来让一个组件对象转换成构造函数形式，<code>extend</code>方法的具体实现我们在之前已经详细介绍过。在转换成构造函数完毕后，又在其对应的<code>options</code>上进行了赋值。根据<code>Vue.component</code>方法的实现，我们可以使用如下案例来表示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'@/components/HelloWorld.vue'</span>
<span class="token comment">// 注册前</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 注册</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">,</span> HelloWorld<span class="token punctuation">)</span>

<span class="token comment">// 注册后</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">HelloWorld</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>既然组件已经注册完毕了，那么我们现在想两个问题：<strong>全局注册的组件到哪里去了？使用全局注册的组件的时候是如何查找的？</strong></p> <p>回答第一个问题的时候，我们先回顾一下<code>components</code>选项是如何合并的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergeAssets</span> <span class="token punctuation">(</span>
  <span class="token parameter">parentVal<span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  childVal<span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  key<span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parentVal <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">extend</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> childVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
strats<span class="token punctuation">.</span>component <span class="token operator">=</span> mergeAssets
</code></pre></div><p>因为全局注册的组件都在<code>Vue.options.components</code>选项上，根据以上合并策略，我们发现全局注册的组件最后都会合并到子组件的<code>components</code>选项的原型上，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 全局注册后</span>
<span class="token keyword">const</span> baseVueOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">HelloWorld</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 合并后</span>
<span class="token keyword">const</span> childOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    __proto__<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">HelloWorld</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根据以上代码，我们就可以回答第一个问题：<strong>全局注册的组件会在子组件配置合并后反应到子组件components属性对象的原型上</strong>。</p> <p>接下来，我们来分析第二个问题，我们回到之前的<code>createElement</code>，在这个章节中，我们注意到有下面这样一段代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>Ctor <span class="token operator">=</span> <span class="token function">resolveAsset</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>$options<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// component</span>
    vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token punctuation">{</span>
  vnode <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当模板编译到全局组件的时候，会在通过<code>resolveAsset</code>去尝试获取组件的构造函数，我们来看一下<code>resolveAsset</code>方法是如何实现的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resolveAsset</span> <span class="token punctuation">(</span>
  <span class="token parameter">options<span class="token operator">:</span> Object<span class="token punctuation">,</span>
  type<span class="token operator">:</span> string<span class="token punctuation">,</span>
  id<span class="token operator">:</span> string<span class="token punctuation">,</span>
  warnMissing<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> id <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> assets <span class="token operator">=</span> options<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
  <span class="token comment">// check local registration variations first</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> assets<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
  <span class="token keyword">const</span> camelizedId <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> camelizedId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> assets<span class="token punctuation">[</span>camelizedId<span class="token punctuation">]</span>
  <span class="token keyword">const</span> PascalCaseId <span class="token operator">=</span> <span class="token function">capitalize</span><span class="token punctuation">(</span>camelizedId<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>assets<span class="token punctuation">,</span> PascalCaseId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> assets<span class="token punctuation">[</span>PascalCaseId<span class="token punctuation">]</span>
  <span class="token comment">// fallback to prototype chain</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> assets<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> assets<span class="token punctuation">[</span>camelizedId<span class="token punctuation">]</span> <span class="token operator">||</span> assets<span class="token punctuation">[</span>PascalCaseId<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> warnMissing <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Failed to resolve '</span> <span class="token operator">+</span> type<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> id<span class="token punctuation">,</span>
      options
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre></div><p>对于<code>components</code>选项来说，它首先会尝试使用<code>hasOwn</code>方法在自身对象上查找有没有，如果三种方式都没有，则最后在<code>components</code>的原型上去查找。对于全局注册的组件而言，它会在这个原型上找到，如果在原型上还找不到，那么最后会在<code>patch</code>的阶段去检验，然后抛出一个错误：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'Unknown custom element: xxx - did you register the component correctly?'</span> <span class="token operator">+</span>
<span class="token string">'For recursive components, make sure to provide the &quot;name&quot; option.'</span><span class="token punctuation">,</span>
</code></pre></div><p>在了解了全局注册组件的方式后，对于局部注册组件的各种疑问相信都迎刃而解了。局部注册的组件都在<code>components</code>选项对象上，而全局注册的组件会在组件合并配置完毕后反应到子组件的<code>components</code>选项对象的原型上，这就是全局注册的组件可以在任意地方使用的根本原因了。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/17/2021, 5:31:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/weblog/vue/component/lifecycle.html" class="prev">
        组件生命周期
      </a></span> <span class="next"><a href="/weblog/vue/compile/">
        介绍
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/weblog/assets/js/app.eefccb8e.js" defer></script><script src="/weblog/assets/js/2.dbfb7c6a.js" defer></script><script src="/weblog/assets/js/51.8586e26f.js" defer></script>
  </body>
</html>
